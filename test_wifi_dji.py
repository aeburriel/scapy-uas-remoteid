# Copyright (C) 2023 Antonio Eugenio Burriel <aeburriel@gmail.com>
#
# This file is part of scapy-uas-remoteid.
#
# scapy-uas-remoteid is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# scapy-uas-remoteid is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with scapy-uas-remoteid.  If not, see <http://www.gnu.org/licenses/>.


from uas_remoteid.common.wifi import parse_dot11
from uas_remoteid.dji.packet import DJIPacket
from scapy.layers.dot11 import Dot11

# https://github.com/DJISDKUser/ESP8266_DJI_DroneID_Throwie
wifipkt = \
    b"\x80\x00\x00\x00\xff\xff\xff\xff\xff\xff\x01\x02\x03\x04\x05\x06" \
    b"\x01\x02\x03\x04\x05\x06\x01\x02\x01\x02\x03\x04\x05\x06\x07\x08" \
    b"\x64\x00\x00\x05\x00\x0c\x41\x42\x43\x44\x45\x46\x41\x42\x43\x44" \
    b"\x45\x46\x01\x08\x82\x84\x8b\x0c\x12\x96\x18\x24\x03\x01\x0b\x05" \
    b"\x04\x00\x01\x00\x00\x07\x06\x55\x53\x00\x01\x0b\x1e\x2a\x01\x00" \
    b"\x32\x04\x30\x48\x60\x6c\x2d\x1a\xac\x01\x02\xff\xff\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x3d\x16\x0b\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x30\x14\x01\x00\x00\x0f" \
    b"\xac\x04\x01\x00\x00\x0f\xac\x04\x01\x00\x00\x0f\xac\x02\x0c\x00" \
    b"\xdd\x18\x00\x50\xf2\x02\x01\x01\x00\x00\x03\xa4\x00\x00\x27\xa4" \
    b"\x00\x00\x42\x43\x5e\x00\x62\x32\x2f\x00\xdd\x52\x26\x37\x12\x58" \
    b"\x62\x13\x10\x01\x5a\x00\xd7\x0f\x44\x72\x6f\x6e\x65\x49\x44\x20" \
    b"\x69\x73\x20\x63\x72\x61\x70\x21\xb0\x78\x5b\x00\x29\xeb\xc2\xfe" \
    b"\xf6\x00\xd3\x00\xd8\x00\xab\x00\x3b\x00\xc0\x00\xf4\x00\x40\x00" \
    b"\x0c\x05\x3c\x00\x30\x79\x2f\x01\x10\x06\x31\x39\x35\x37\x34\x31" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"

# Telemetry
# https://github.com/llorencroma/DJIDroneIDspoofer/blob/main/replay_mavic.py
payload_info = \
    b"\x58\x62\x13\x10\x02\x4d\x06\x33\x1f\x30\x4b\x31\x43\x47\x36\x47" \
    b"\x33\x41\x48\x38\x56\x32\x4d\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\xef\xff\x0c\x00\x00\x00\x00\x00\x00\x00\xb0\x43\x85\xb3\xa0" \
    b"\x28\x76\x01\x00\x00\x45\x89\x7c\x00\xcc\x3d\x14\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"

# Flight Info
# https://github.com/llorencroma/DJIDroneIDspoofer/blob/main/replay_mavic.py
payload_purpose = \
    b"\x58\x62\x13\x11\x33\x4b\x31\x43\x47\x36\x47\x33\x41\x48\x38\x56" \
    b"\x32\x4d\x00\x00\xcc\xaa\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00" \
    b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"

if __name__ == "__main__":
    for packet in [
        payload_info,
        payload_purpose,
    ]:
        msg = DJIPacket(packet)
        msg.show()

    for packet in [
        wifipkt,
    ]:
        for msg in parse_dot11(Dot11(packet)):
            msg.show()
